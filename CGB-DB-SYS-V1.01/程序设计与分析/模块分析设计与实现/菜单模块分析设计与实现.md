# 1. 菜单模块分析 #

> 菜单管理又称为资源管理，是系统资源对外的表现形式。

菜单就是数据的类名,如`手机/电脑/主机`这就是一个一级菜单,可以细分为三个二级菜单

## 1.1 数据库设计 ##

### 1.1.1 数据库表设计 ###

| 字段名       | 类型     | 约束    | 说明                           |
| ------------ | -------- | ------- | ------------------------------ |
| id           | int      | primary | 菜单主键                       |
| name         | varchar  |         | 菜单名称                       |
| url          | varchar  |         | 资源URL                        |
| type         | int      |         | 类型<br />1: 菜单<br />2: 按钮 |
| sort         | int      |         | 排序                           |
| note         | varchar  |         | 备注                           |
| parentId     | int      |         | 父辈菜单id                     |
| permission   | varchar  |         | 授权,如                        |
| createdTime  | datetime |         | 创建时间                       |
| modifiedTime | datetime |         | 修改时间                       |
| createdUser  | varchar  |         | 创建用户                       |
| modifiedUser | varchar  |         | 修改用户                       |

### 1.1.2 数据关系分析 ###

菜单管理又称为资源管理，是系统资源对外的表现形式

所以不同的角色之间所拥有的菜单也不相同

在数据库中菜单和角表示多对多的关系,一个角色可以查看多个菜单,一个菜单可以被多个角色查看

<img src="https://gitee.com/teamsea/tuchuang/raw/master/tuchuang/image5-2023-10-1115:30:00.png" alt="image5-2023-10-1115:30:00.png" style="zoom:67%;" />

需要一张表来描述两个表之间的关系

<img src="https://gitee.com/teamsea/tuchuang/raw/master/tuchuang/image8-2023-10-1115:36:38.png" alt="image8-2023-10-1115:36:38.png" style="zoom:67%;" />

在删除表时应该进行阻止,先将主表中关系进行删除,在删除从表中的内容

## 1.2 创建主表 ##

| 字段名  | 类型 | 约束    | 说明   |
| ------- | ---- | ------- | ------ |
| id      | int  | primary | 主键   |
| role_id | int  |         | 角色id |
| menu    | int  |         | 菜单id |

# 2. 原型说明 #

菜单浏览页面

<img src="https://gitee.com/teamsea/tuchuang/raw/master/tuchuang/image6-2023-10-1115:56:25.png" alt="image6-2023-10-1115:56:25.png" style="zoom:67%;" />

菜单添加页面

<img src="https://gitee.com/teamsea/tuchuang/raw/master/tuchuang/image19-2023-10-1116:03:44.png" alt="image19-2023-10-1116:03:44.png" style="zoom:67%;" />

在编辑上级菜单时会有弹窗加载页面

<img src="https://gitee.com/teamsea/tuchuang/raw/master/tuchuang/image17-2023-10-1116:04:59.png" alt="image17-2023-10-1116:04:59.png" style="zoom:67%;" />

# 3. API架构分析 #

![image21-2023-10-1209:37:02.png](https://gitee.com/teamsea/tuchuang/raw/master/tuchuang/image21-2023-10-1209:37:02.png)

+ 数据层:

  在数据层中有两个`dao`分别控制这两张表,菜单表和菜单角色关系表

# 4. 菜单页面呈现 #

## 4.1 菜单页面呈现功能分析 ##

页面呈现时序图

<img src="https://gitee.com/teamsea/tuchuang/raw/master/tuchuang/image12-2023-10-1209:44:15.png" alt="image12-2023-10-1209:44:15.png" style="zoom:67%;" />

## 4.2 菜单页面呈现实现 ##

服务器端

```java
/**
 * Menu菜单数据展示页面,用来展示数据信息和数据操作
 */
@RequestMapping("menu/menu_list")
public String doMenusUI() {
	return "sys/menu_list";
}
```

客户端

```js
//单击按钮加载页面
$(function(){
     doLoadUI("load-menu-id","menu/menu_list");
});
```

### ###REST风格URL映射 ###

[什么是REST风格? 什么是RESTFUL?（一篇全读懂）_rest风格和restful风格-CSDN博客](https://blog.csdn.net/SeniorShen/article/details/111591122)

我们这里可以写一个万能也页面加载方法

```java
/**
 * 页面加载的通用方法
 * 
 * @param moduleUI 模块页面名称
 */
@RequestMapping("/{module}/{moduleUI}")
public String ModuleUI(@PathVariable String moduleUI) {
	return "sys/"+moduleUI;
}
```

这个方法的优先级和低(有较强的通用性),如果有指定地址型的方法,会优先执行指定地址值的方法

> REST风格的URL映射
> REST是一种软件架构编码风格,在这种风格下的url定义,可以使用变量的方法让url更加简单
>
> 在方法参数中需要url中的{变量}值时,使用注解`@pathVariable`进行获取,并且要求被修饰的变量名,和{变量}表达式中的变量名相同

# 5. 菜单查询功能 #

## 5.1 菜单查询功能分析与设计 ##

### 5.1.1 查询数据分析 ###

每个菜单都有一个属性:`parentId`父菜单

我们查询数据时,要形成自关联,查询的信息要包含符菜单的信息

![image14-2023-10-1213:52:27.png](https://gitee.com/teamsea/tuchuang/raw/master/tuchuang/image14-2023-10-1213:52:27.png)

所以要是用关联查询`join`或者子查询

### 5.1.2 数据架构分析 ###

![image20-2023-10-1210:56:49.png](https://gitee.com/teamsea/tuchuang/raw/master/tuchuang/image20-2023-10-1210:56:49.png)

+ 查询到的数据封装到Map中

  一个map对应一行的数据,其中key表示字段名,value为其中的值

  <font color='red'>一般情况下,使用map封装我们的对象是不被允许的要使用pojo对象来封装查询的到信息</font>

  使用map对象的优点:开发效率高,可以做到快速去重,可一确定关联关系

  缺点:没有类型泛型,无法约束

  因为我们查询数据不涉及到分页,所以我们查询到的数据直接放置到`view object`JSONResult对象中

### 5.1.3 时序图分析 ###

![image18-2023-10-1211:13:45.png](https://gitee.com/teamsea/tuchuang/raw/master/tuchuang/image18-2023-10-1211:13:45.png)

+ 我们先查询数据,查询到的对象封装到map中
+ 将`List<Map>`直接放置到`View Object`JsonResult类中

## 5.2 菜单查询功能实现 ##

### 5.2.1 持久层实现 ###

#### mapper 接口实现 ####

```java
@Mapper
public interface MenusDao {  
    List<Map<String,Object>> findObjects();
}
```

#### SQL语句设计 ####

使用关联查询来实现:

[SQL关联查询_sql关联关系-CSDN博客](https://blog.csdn.net/s1f56s/article/details/91383814)

```xml
<select id="findObjects" resultType="Map">
	select c.*,p.name parentName from sys_menus c left join sys_menus p on c.parentId=p.id
</select>
```

使用子查询来实现:

[SQL 子查询_w3cschool](https://www.w3cschool.cn/sql/zjdc1oz3.html)

```xml
<select id="findObjects" resultType="Map">
	select c.*,(select p.name from sys_menus p where c.parentId=p.id) parentName from sys_menus c
</select>
```

### 5.2.2 业务层实现 ###



### 5.2.3 控制层实现 ###

### 5.2.4 客户端实现 ###
